// https://docs.renovatebot.com/configuration-options/
{
	"$schema": "https://docs.renovatebot.com/renovate-schema.json",

	"extends": [
		// Enables sensible defaults for most project types
		"config:recommended",

		// Groups packages from monorepos together (e.g., all @babel/* packages)
		"group:monorepos",

		// Groups related packages that should update together (e.g., react & react-dom)
		"group:recommended",

		// Separate PRs for each major version when multiple majors available
		":separateMultipleMajorReleases",

		// This enables smart 'feat'/'fix' types, overriding the
		// conservative 'chore' default from config:recommended
		":semanticCommits"
	],

	// Separate minor and patch updates into different PRs
	// This helps distinguish between feature updates (minor) and bug fixes (patch)
	"separateMinorPatch": true,

	// This section forces Renovate to always pin GitHub Actions to a specific commit hash
	// for maximum build reproducibility. It automatically adds a comment with the
	// original version tag, e.g., uses: actions/checkout@a1b2c3d4... # v4.1.1
	"github-actions": {
		"pinDigests": true
	},

	// When updating a version range (e.g., "^1.2.3"), bump the version in-place
	// to "^1.3.0" rather than replacing the range ("1.3.0"). This is a best practice
	// when using a lockfile.
	"rangeStrategy": "bump",

	"packageRules": [
		// NOTE ON DEVDEPENDENCIES IN BUNDLED PACKAGES:
		// Many packages use bundlers (pkgroll, esbuild, rollup) that inline devDependencies
		// into the published output. This means devDependency updates CAN affect production code.
		// This configuration treats all dependencies conservatively, requiring manual review
		// for minor updates regardless of dependency type.

		// === PATCH UPDATES (bug fixes) ===
		// Manual review required because:
		// 1. Bundled packages: patches change the published output directly
		// 2. Non-bundled packages: need to decide if a fix release is warranted for consumers
		// Without a release, consumers won't get security/bug fixes in transitive dependencies
		{
			"description": "Schedule patch updates (bug fixes) - manual review required",
			"matchUpdateTypes": [
				"patch",
				"digest"
			],
			// PR Creation: Friday 6-7 AM JST (Thursday 21:00-22:00 UTC)
			// Cron: * 21 * * 4 (every minute of hour 21 on Thursday UTC)
			"schedule": [
				"* 21 * * 4"
			],
			// No automerge - need to assess if fix release is needed
			"automerge": false,
			// Group all patch updates together to reduce PR noise
			"groupName": "patch-updates",
			"groupSlug": "patch"
		},

		// === MINOR UPDATES (new features) ===
		// These may introduce new functionality and deserve more review time.
		// NOTE: This includes devDependencies that may be bundled into the output
		// (e.g., when using bundlers to inline dependencies).
		{
			"description": "Schedule minor updates (new features) - manual review required",
			"matchUpdateTypes": [
				"minor"
			],
			// Friday 6-7 AM JST (Thursday 21:00-22:00 UTC) - same as patches but no automerge
			// Cron: * 21 * * 4 (every minute of hour 21 on Thursday UTC)
			"schedule": [
				"* 21 * * 4"
			],
			// No automerge for minor updates since they may affect bundled output
			"automerge": false
		},
		{
			// This rule handles ALL GitHub Action updates (pinning and version bumps).
			// It assigns them to a separate group and sets their commit type to 'ci'.
			"description": "Group GitHub Actions and set commit type to 'ci'",
			"matchManagers": [
				"github-actions"
			],
			"groupName": "github-actions",
			"semanticCommitType": "ci",
			"semanticCommitScope": "github-actions"
		},
		{
			// Specifically enable updates for the "packageManager" field in package.json,
			// used for managing the pnpm version via Corepack.
			"description": "Enable pnpm packageManager updates",
			"matchManagers": [
				"npm"
			],
			"matchDepTypes": [
				"packageManager"
			],
			"enabled": true
		},
		{
			// Disable Node.js version updates in package.json engines field.
			// Only .nvmrc should be updated (development Node version).
			"description": "Disable package.json engines.node updates",
			"matchManagers": [
				"npm"
			],
			"matchDepTypes": [
				"engines"
			],
			"enabled": false
		},
		{
			// Peer dependency updates affect consumers and require a release.
			// Bumping peer dependencies is a consumer-facing change that enforces
			// new minimum version requirements on the host environment.
			"description": "Peer dependency updates affect consumers and require a release",
			"matchDepTypes": [
				"peerDependencies"
			],
			"semanticCommitType": "fix"
		}
	],

	// Regenerate the pnpm-lock.yaml file weekly to pull in the latest transitive
	// dependencies. This PR is kept separate from other updates and is automerged.
	"lockFileMaintenance": {
		"enabled": true,
		"automerge": true,
		// Automerge: Friday 5-6 AM JST (Thursday 20:00-21:00 UTC)
		// Cron: * 20 * * 4 (every minute of hour 20 on Thursday UTC)
		"automergeSchedule": [
			"* 20 * * 4"
		],
		// PR Creation: Friday 6-7 AM JST (Thursday 21:00-22:00 UTC)
		// Cron: * 21 * * 4 (every minute of hour 21 on Thursday UTC)
		"schedule": [
			"* 21 * * 4"
		]
	}
}
